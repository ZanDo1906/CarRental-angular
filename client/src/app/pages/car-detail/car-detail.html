<div class="container car-detail-page" *ngIf="car; else loading">
  
  <!-- Main Content Grid -->
  <div class="detail-layout">
    
    <!-- Left Column: Gallery -->
    <div class="gallery-section">
      <div class="main-image">
        <img [src]="hero || car?.Anh_xe?.[0] || 'assets/images/placeholder.webp'" 
             [alt]="car.Hang_xe + ' ' + car.Dong_xe">
      </div>
      <div class="thumbnail-grid">
        <img *ngFor="let img of car?.Anh_xe?.slice(1, 4)" 
             [src]="img" 
             [alt]="car.Hang_xe"
             (click)="setHero(img)"
             [class.active]="img === hero">
      </div>
    </div>

    <!-- Right Column: Info -->
    <div class="info-section">
      <!-- Header -->
      <div class="car-header">
        <div class="title-row">
          <h1 class="car-title">{{car.Hang_xe}} {{car.Dong_xe}}</h1>
          <div class="actions-icons">
            <button class="icon-btn"><i class="bi bi-share"></i></button>
            <button class="icon-btn"><i class="bi bi-heart"></i></button>
          </div>
        </div>
        <div class="rating-row">
          <span class="rating">
            <i class="bi bi-star-fill"></i>
            {{car.Diem_danh_gia || 5.0}}
          </span>
          <span class="dot">•</span>
          <span class="trips">{{car.So_chuyen || car.So_luot_danh_gia || 0}} chuyến</span>
        </div>
      </div>

      <!-- Đặc điểm -->
      <div class="features-section">
        <h3 class="section-title">Đặc điểm</h3>
        <div class="features-grid">
          <div class="feature-item">
            <i class="bi bi-diagram-3"></i>
            <div class="feature-content">
              <div class="feature-label">Số ghế</div>
              <div class="feature-value">{{car.So_cho}} chỗ</div>
            </div>
          </div>
          <div class="feature-item">
            <i class="bi bi-palette"></i>
            <div class="feature-content">
              <div class="feature-label">Màu xe</div>
              <div class="feature-value">{{car.Mau_sac || 'Đen'}}</div>
            </div>
          </div>
          <div class="feature-item">
            <i class="bi bi-gear"></i>
            <div class="feature-content">
              <div class="feature-label">Truyền động</div>
              <div class="feature-value">{{car.Hop_so}}</div>
            </div>
          </div>
          <div class="feature-item">
            <i class="bi bi-ev-front"></i>
            <div class="feature-content">
              <div class="feature-label">Dòng xe</div>
              <div class="feature-value">{{car.Loai_xe || 'Sedan'}}</div>
            </div>
          </div>
          <div class="feature-item">
            <i class="bi bi-fuel-pump"></i>
            <div class="feature-content">
              <div class="feature-label">Nhiên liệu</div>
              <div class="feature-value">{{car.Nhien_lieu}}</div>
            </div>
          </div>
          <div class="feature-item">
            <i class="bi bi-speedometer2"></i>
            <div class="feature-content">
              <div class="feature-label">Mức tiêu thụ</div>
              <div class="feature-value">{{car.Muc_tieu_thu || '6.5'}} lít/100km</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Mô tả -->
      <div class="description-section">
        <h3 class="section-title">Mô tả</h3>
        <p class="description-text">{{car.Mo_ta || 'Xe trong tình trạng tốt, bảo dưỡng định kỳ.'}}</p>
      </div>

      <!-- Các tiện nghi khác -->
      <div class="amenities-section">
        <h3 class="section-title">Các tiện nghi khác</h3>
        <div class="amenities-list">
          <div class="amenity-item">
            <i class="bi bi-camera-video"></i>
            <span>Camera hành trình</span>
          </div>
          <div class="amenity-item">
            <i class="bi bi-geo-alt"></i>
            <span>Định vị GPS</span>
          </div>
          <div class="amenity-item">
            <i class="bi bi-usb-symbol"></i>
            <span>Khe cắm USB</span>
          </div>
          <div class="amenity-item">
            <i class="bi bi-disc"></i>
            <span>Lốp dự phòng</span>
          </div>
          <div class="amenity-item">
            <i class="bi bi-bluetooth"></i>
            <span>Bluetooth</span>
          </div>
          <div class="amenity-item">
            <i class="bi bi-droplet"></i>
            <span>Cảm biến lốp</span>
          </div>
          <div class="amenity-item">
            <i class="bi bi-badge-4k"></i>
            <span>Camera 360</span>
          </div>
          <div class="amenity-item">
            <i class="bi bi-laptop"></i>
            <span>ETC</span>
          </div>
          <div class="amenity-item">
            <i class="bi bi-map"></i>
            <span>Bản đồ</span>
          </div>
        </div>
      </div>

      <!-- Điều khoản -->
      <div class="terms-section">
        <h3 class="section-title">Điều khoản</h3>
        <ul class="terms-list">
          <li>Sử dụng xe đúng mục đích.</li>
          <li>Không sử dụng xe thuê vào mục đích phi pháp, trái pháp luật.</li>
          <li>Không sử dụng xe thuê để cầm cố, thế chấp.</li>
          <li>Không hút thuốc, nhả kẹo cao su, xả rác trong xe.</li>
          <li>Trả xe đúng hạn. Trường hợp trả muộn, khách hàng sẽ chịu phụ phí.</li>
        </ul>
      </div>

      <!-- Chính sách huỷ chuyến -->
      <div class="policy-section">
        <h3 class="section-title">Chính sách huỷ chuyến</h3>
        <div class="policy-table">
          <div class="policy-row">
            <div class="policy-time">Trong vòng 1h</div>
            <div class="policy-fee">Hoàn tiền 100%</div>
          </div>
          <div class="policy-row">
            <div class="policy-time">Trước chuyến đi 7 ngày</div>
            <div class="policy-fee">Hoàn tiền 70%</div>
          </div>
          <div class="policy-row">
            <div class="policy-time">Trong vòng 7 ngày</div>
            <div class="policy-fee">Không hoàn tiền</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Price & Booking Card (Fixed) -->
  <div class="booking-card">
    <div class="price-info">
      <div class="price-amount">{{vnd(car.Gia_thue)}}<span class="price-unit">/ngày</span></div>
      <div class="location-info">
        <i class="bi bi-geo-alt-fill"></i>
        <span>{{ getLocationAddress(car.Ma_vi_tri) }}</span>
      </div>
    </div>
    <button class="btn-rent">Thuê xe</button>
  </div>

  <!-- Chủ xe section -->
  <div class="owner-section">
    <h3 class="section-title">Chủ xe</h3>
    <div class="owner-card">
      <div class="owner-info">
        <img src="assets/images/default-avatar.png" alt="Owner" class="owner-avatar">
        <div class="owner-details">
          <h4 class="owner-name">{{getOwnerName()}}</h4>
          <div class="owner-stats">
            <span class="stat-item">
              <i class="bi bi-star-fill"></i> {{car.Diem_danh_gia || 5.0}}
            </span>
            <span class="dot">•</span>
            <span class="stat-item">{{car.So_chuyen || 0}} chuyến</span>
          </div>
        </div>
      </div>
      <div class="owner-badges">
        <span class="badge-item">Chủ xe uy tín</span>
      </div>
    </div>

    <!-- Reviews -->
    <div class="reviews-section">
      <h4 class="reviews-title">Đánh giá</h4>
      <div class="review-summary">
        <div class="rating-bars">
          <div class="rating-bar-item">
            <span class="stars">5 <i class="bi bi-star-fill"></i></span>
            <div class="bar"><div class="fill" style="width: 80%"></div></div>
            <span class="count">16</span>
          </div>
          <div class="rating-bar-item">
            <span class="stars">4 <i class="bi bi-star-fill"></i></span>
            <div class="bar"><div class="fill" style="width: 15%"></div></div>
            <span class="count">3</span>
          </div>
          <div class="rating-bar-item">
            <span class="stars">3 <i class="bi bi-star-fill"></i></span>
            <div class="bar"><div class="fill" style="width: 5%"></div></div>
            <span class="count">1</span>
          </div>
          <div class="rating-bar-item">
            <span class="stars">2 <i class="bi bi-star-fill"></i></span>
            <div class="bar"><div class="fill" style="width: 0%"></div></div>
            <span class="count">0</span>
          </div>
          <div class="rating-bar-item">
            <span class="stars">1 <i class="bi bi-star-fill"></i></span>
            <div class="bar"><div class="fill" style="width: 0%"></div></div>
            <span class="count">0</span>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<ng-template #loading>
  <div class="container">
    <p class="text-center py-5">Đang tải chi tiết xe…</p>
  </div>
</ng-template>