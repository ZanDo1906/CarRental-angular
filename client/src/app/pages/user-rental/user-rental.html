<main class="main-content">
  <div class="page-header">
    <h2>Chuyến của tôi ({{ rentals.length }})</h2>
  </div>

  <!-- Tabs -->
  <div class="rental-tabs">
    <button 
      class="tab-btn"
      [class.active]="activeTab === 'current'"
      (click)="switchTab('current')">
      <i class="bi bi-hourglass-split"></i>
      Chuyến hiện tại ({{ currentRentals.length }})
    </button>
    <button 
      class="tab-btn"
      [class.active]="activeTab === 'history'"
      (click)="switchTab('history')">
      <i class="bi bi-clock-history"></i>
      Lịch sử chuyến ({{ historyRentals.length }})
    </button>
  </div>

  <div class="alert alert-info" *ngIf="loading">
    Đang tải dữ liệu...
  </div>

  <div class="alert alert-warning" *ngIf="!loading && filteredRentals.length === 0">
    <span *ngIf="activeTab === 'current'">Bạn chưa có chuyến đi hiện tại nào.</span>
    <span *ngIf="activeTab === 'history'">Bạn chưa có lịch sử chuyến đi nào.</span>
  </div>

  <div class="cards-list" *ngIf="!loading && filteredRentals.length > 0">

            <div *ngFor="let rental of paginatedRentals" class="car-card">

              <div class="car-avatar">
                <div class="thumb">
                  <ng-container *ngIf="rental.car_details.Anh_xe && rental.car_details.Anh_xe.length > 0">
                  <img [src]="rental.car_details.Anh_xe[0]" 
                       [alt]="rental.car_details.Dong_xe"
                       onerror="this.src='assets/images/placeholder.webp'">
                </ng-container>
                <img *ngIf="!rental.car_details.Anh_xe || rental.car_details.Anh_xe.length === 0"
                     src="assets/images/placeholder.webp"
                     alt="No car image">
                </div>
              </div>

              <div class="car-details">
                <div>
                  <h3 class="car-name">{{ rental.car_details.Hang_xe }} {{ rental.car_details.Dong_xe }} {{ rental.car_details.Nam_san_xuat
                  }}</h3>
                </div>
                <!-- <div class="meta-row">
                  <div class="meta">
                    <i class="bi bi-gear"></i>
                    <span>{{ rental.car_details.Hop_so }}</span>
                  </div>
                  <div class="meta">
                    <i class="bi bi-people"></i>
                    <span>{{ rental.car_details.So_cho }} chỗ</span>
                  </div>
                  <div class="meta">
                    <i class="bi bi-fuel-pump"></i>
                    <span>{{ rental.car_details.Nhien_lieu }}</span>
                  </div>
                </div> -->

                <!-- Địa điểm (resolve Ma_vi_tri → địa chỉ từ location.json) -->
                <!-- <div class="loc-row" *ngIf="car.Ma_vi_tri != null">
                  <i class="bi bi-geo-alt"></i>
                  <span>{{ getLocationAddress(car.Ma_vi_tri) }}</span>
                </div> -->

                <hr>

                <!-- Điểm & số chuyến -->
                <!-- <div class="meta-row">
                  <div class="meta">
                    <i class="bi bi-star-fill text-warning"></i>
                    <span>{{ rental.car_details.Diem_danh_gia || '5.0'}}</span>
                  </div>
                  <div class="meta">
                    <i class="bi bi-graph-up"></i>
                    <span>{{ rental.car_details.So_chuyen || rental.car_details.So_luot_thue || 0}} chuyến</span>
                  </div>
                </div> -->

                

                

                <div class="meta-row" >
                  <div class="meta" *ngIf="rental.Ma_vi_tri_nhan != null">
                    <i class="bi bi-geo-alt"></i>
                    Vị trí nhận:
            <span>{{ getLocationAddress(rental.Ma_vi_tri_nhan) }}</span>
                  </div>
                  <div class="meta" *ngIf="rental.Ma_vi_tri_tra != null">
                    <i class="bi bi-geo-alt"></i>
                    Vị trí trả:
                    <span>{{ getLocationAddress(rental.Ma_vi_tri_tra) }}</span>
                  </div>
                </div>

                 <div class="meta-row  ">
                  <div class="meta">
                    <i class="bi bi-calendar-check"></i>
                    <span>Ngày nhận: {{ formatDate(rental.Ngay_nhan_xe) }} {{ rental.Gio_nhan_xe }}</span>
                  </div>
                  <div class="meta">
                    <i class="bi bi-calendar-x"></i>
                    <span>Ngày trả: {{ formatDate(rental.Ngay_tra_xe) }} {{ rental.Gio_tra_xe }}</span>
                  </div>
                </div>


                <!-- Giá -->
                <div class="price-row">
                  <div class="price fs-4">
                    {{vnd(rental.Tong_chi_phi)}} VNĐ
                  </div>
                </div>

                <span class=" status-badge rental-status" [ngClass]="getStatusClass(rental.Trang_thai)">
                    {{ getStatusText(rental.Trang_thai) }}
                  </span>
                <!-- <div class="rental-date text-muted">
                  Ngày trả: 
                    <span class="">{{formatDate(rental.Ngay_tra_xe)}} {{rental.Gio_tra_xe}}</span>
                </div> -->
              </div>

              <div class="rental-actions">
                <!-- <p class="rental-status">Đang cho thuê</p> -->
                 <span class=" status-badge rental-status" [ngClass]="getStatusClass(rental.Trang_thai)">
                    {{ getStatusText(rental.Trang_thai) }}
                  </span>
                <!-- <div class="rental-date text-muted">
                  Ngày trả: 
                    <span class="">{{formatDate(rental.Ngay_tra_xe)}} {{rental.Gio_tra_xe}}</span>
                </div> -->
                <ng-container *ngIf="activeTab === 'current'">
                  <button *ngIf="rental.Trang_thai === 1" class="btn btn-outline-danger">
                    <i class="bi bi-x-circle"></i> Hủy đặt xe
                  </button>
                  <button *ngIf="rental.Trang_thai === 3" class="btn btn-solid-primary">
                    <i class="bi bi-check-circle"></i> Xác nhận trả xe
                  </button>
                  <button *ngIf="rental.Trang_thai === 2 || rental.Trang_thai === 3" class="btn btn-approve">
                    <i class="bi bi-clock-history"></i> Gia hạn thuê
                  </button>
                </ng-container>
                <ng-container *ngIf="activeTab === 'history'">
                  <button *ngIf="rental.Trang_thai === 4" class="btn btn-solid-primary">
                    <i class="bi bi-arrow-repeat"></i> Thuê lại
                  </button>
                  <button *ngIf="rental.Trang_thai === 4" class="btn btn-approve">
                    <i class="bi bi-star"></i> Đánh giá
                  </button>
                  <button *ngIf="rental.Trang_thai === 4" class="btn btn-outline-danger">
                    <i class="bi bi-exclamation-circle"></i> Khiếu nại
                  </button>
                </ng-container>
                
                <!-- <button class="btn btn-outline-secondary">
                  <i class="bi bi-eye"></i> Chi tiết
                </button> -->

                
                <!-- <button  class="btn btn-solid-primary">Trả xe</button>
                <button  class="btn btn-approve">Gia hạn thuê</button>
                <button  class="btn btn-outline-danger">Khiếu nại</button> -->
              </div>
            </div>
            <!-- Thân card -->
            <!-- <div class="card-body">
              <h3 class="car-name fw-bold fs-4">{{car.Hang_xe}} {{car.Dong_xe}} {{car.Nam_san_xuat}}</h3> -->

            <!-- Hàng 3 thông số -->
            <!-- <div class="spec-grid">
                <div class="spec">
                  <i class="bi bi-gear"></i>
                  <span>{{car.Hop_so}}</span>
                </div>
                <div class="spec">
                  <i class="bi bi-people"></i>
                  <span>{{car.So_cho}} chỗ</span>
                </div>
                <div class="spec">
                  <i class="bi bi-fuel-pump"></i>
                  <span>{{car.Nhien_lieu}}</span>
                </div>
              </div> -->

            <!-- Địa điểm (resolve Ma_vi_tri → địa chỉ từ location.json) -->
            <!-- <div class="loc-row" *ngIf="car.Ma_vi_tri != null">
                <i class="bi bi-geo-alt"></i>
                <span>{{ getLocationAddress(car.Ma_vi_tri) }}</span>
              </div> -->



          </div>


          <!-- <div class="rental-cards-container" *ngIf="!loading && rentals.length > 0">
            <div *ngFor="let rental of paginatedRentals" class="rental-item"
              style="display: flex !important; flex-direction: row !important; align-items: center !important; gap: 1.5rem !important; background: white !important; border-radius: 12px !important; padding: 1.25rem !important; margin-bottom: 1.25rem !important; border: 1px solid #e0e0e0 !important;"> -->
              <!-- Hình ảnh xe -->
              <!-- <div class="rental-avatar"
                style="flex-shrink: 0 !important; width: 180px !important; height: 120px !important; border-radius: 10px !important; overflow: hidden !important; background-color: #f8faf7 !important;">
                <ng-container *ngIf="rental.car_details.Anh_xe && rental.car_details.Anh_xe.length > 0">
                  <img [src]="rental.car_details.Anh_xe[0]" [alt]="rental.car_details.Dong_xe"
                    onerror="this.src='assets/images/placeholder.webp'">
                </ng-container>
                <img *ngIf="!rental.car_details.Anh_xe || rental.car_details.Anh_xe.length === 0"
                  src="assets/images/placeholder.webp" alt="No car image">
              </div> -->

              <!-- Thông tin chuyến đi -->
              <!-- <div class="rental-details"
                style="flex: 1 !important; min-width: 0 !important; display: flex !important; flex-direction: column !important; gap: 0.75rem !important;">
                <h3>{{ rental.car_details.Hang_xe }} {{ rental.car_details.Dong_xe }} {{ rental.car_details.Nam_san_xuat
                  }}</h3>

                <div class="rental-info-grid"
                  style="display: grid !important; grid-template-columns: repeat(2, 1fr) !important; gap: 0.5rem !important; margin-bottom: 0.5rem !important;">
                  <div class="info-row"
                    style="display: flex !important; align-items: center !important; gap: 0.5rem !important; font-size: 13px !important;">
                    <i class="bi bi-calendar-check" style="color: #1D7363 !important; font-size: 14px !important;"></i>
                    <span>{{formatDate(rental.Ngay_nhan_xe)}} {{rental.Gio_nhan_xe}}</span>
                  </div>

                  <div class="info-row"
                    style="display: flex !important; align-items: center !important; gap: 0.5rem !important; font-size: 13px !important;">
                    <i class="bi bi-calendar-x" style="color: #1D7363 !important; font-size: 14px !important;"></i>
                    <span>{{formatDate(rental.Ngay_tra_xe)}} {{rental.Gio_tra_xe}}</span>
                  </div>

                  <div class="info-row"
                    style="display: flex !important; align-items: center !important; gap: 0.5rem !important; font-size: 13px !important;">
                    <i class="bi bi-geo-alt-fill" style="color: #1D7363 !important; font-size: 14px !important;"></i>
                    <span>{{ getLocationAddress(rental.Ma_vi_tri_nhan) }}</span>
                  </div>

                  <div class="info-row"
                    style="display: flex !important; align-items: center !important; gap: 0.5rem !important; font-size: 13px !important;">
                    <i class="bi bi-currency-dollar" style="color: #1D7363 !important; font-size: 14px !important;"></i>
                    <span>{{vnd(rental.Tong_chi_phi)}} VND</span>
                  </div>
                </div>

                <div class="status-badge" [ngClass]="getRentalStatusClass(rental.Trang_thai)">
                  {{ getRentalStatusText(rental.Trang_thai) }}
                </div>
              </div> -->

              <!-- Actions -->
              <!-- <div class="rental-actions"
                style="display: flex !important; flex-direction: column !important; gap: 0.5rem !important; flex-shrink: 0 !important; min-width: 140px !important; align-items: stretch !important;">
                <button class="btn btn-solid-primary">
                  <i class="bi bi-eye"></i>
                  Xem chi tiết
                </button>
                <button class="btn btn-approve" *ngIf="rental.Trang_thai === 2">
                  <i class="bi bi-telephone"></i>
                  Liên hệ
                </button>
                <button class="btn btn-outline-danger" *ngIf="rental.Trang_thai === 1">
                  <i class="bi bi-x-circle"></i>
                  Hủy chuyến
                </button>
              </div>
            </div>
          </div> -->

          <!-- <!Pagination --> 
            <nav aria-label="Page navigation" class="d-flex justify-content-end mt-3" *ngIf="totalPages > 1">
              <ul class="pagination">
                <li class="page-item" [class.disabled]="currentPage === 1">
                  <a class="page-link" (click)="changePage(currentPage - 1)" href="javascript:void(0)"
                    aria-label="Previous">
                    <i class="bi bi-chevron-left"></i>
                  </a>
                </li>
                <li *ngFor="let page of [].constructor(totalPages); let i = index" class="page-item"
                  [class.active]="(i + 1) === currentPage">
                  <a class="page-link" (click)="changePage(i + 1)" href="javascript:void(0)">
                    {{ i + 1 }}
                  </a>
                </li>
                <li class="page-item" [class.disabled]="currentPage === totalPages">
                  <a class="page-link" (click)="changePage(currentPage + 1)" href="javascript:void(0)"
                    aria-label="Next">
                    <i class="bi bi-chevron-right"></i>
                  </a>
              </li>
            </ul>
          </nav>
</main>