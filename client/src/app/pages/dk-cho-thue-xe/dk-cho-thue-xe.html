<div class="container">
    <div class="form-container">
        <!-- Header -->
        <h2 class="brand-text fw-bold fs-4 text-center mt-1">ĐĂNG KÝ XE</h2>

        <!-- Progress Steps -->
        <div class="progress-container">
            <div class="step" [class.active]="currentStep === 1">
                <div class="step-number">1</div>
                <span class="step-label">Thông tin xe</span>
            </div>
            <div class="arrow">
                <i class="bi bi-arrow-right"></i>
            </div>
            <div class="step" [class.active]="currentStep === 2">
                <div class="step-number">2</div>
                <span class="step-label">Thông tin thuê xe</span>
            </div>
            <div class="arrow">
                <i class="bi bi-arrow-right"></i>
            </div>
            <div class="step" [class.active]="currentStep === 3">
                <div class="step-number">3</div>
                <span class="step-label">Hình ảnh xe</span>
            </div>
        </div>

        <!-- Form -->
        <form class="registration-form">
            <!-- Step 1: Thông tin xe -->
            <div *ngIf="currentStep === 1">
                <!-- Biển số xe -->
                <div class="form-section">
                    <h3 class="small-title">Biển số xe</h3>
                    <p class="note">Lưu ý: Biển số sẽ không thể thay đổi sau khi đăng kí.</p>
                    <div class="license-plate-container">
                        <input type="text" class="form-input license-plate-input" [class.error]="errors.bienSo"
                            [class.valid]="step1Data.bienSo && isValidLicensePlate(step1Data.bienSo)"
                            [(ngModel)]="step1Data.bienSo" name="bienSo" placeholder="" (input)="onLicensePlateChange()"
                            maxlength="10">
                    </div>
                    <div *ngIf="errors.bienSo" class="error-message">Vui lòng nhập biển số xe đúng định dạng (VD:
                        51A-123.45)</div>
                    <div *ngIf="step1Data.bienSo && isValidLicensePlate(step1Data.bienSo)" class="success-message">
                        ✓ Biển số hợp lệ
                    </div>
                </div>

                <!-- Thông tin cơ bản -->
                <div class="form-section">
                    <h3>Thông tin cơ bản</h3>
                    <p class="note">Lưu ý: Các thông tin cơ bản sẽ không thể thay đổi sau khi đăng ký</p>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Hãng xe</label>
                            <select class="form-input" [class.error]="errors.hangXe" [(ngModel)]="step1Data.hangXe"
                                name="hangXe" (change)="onCarBrandChange()">
                                <option value="">-- Chọn hãng xe --</option>
                                <option *ngFor="let brand of availableCarBrands" [value]="brand">{{brand}}</option>
                                <option value="Khác">Khác</option>
                            </select>
                            <div *ngIf="errors.hangXe" class="error-message">Vui lòng chọn hãng xe</div>

                            <!-- Input cho hãng xe khác -->
                            <div *ngIf="step1Data.hangXe === 'Khác'" class="mt-2">
                                <input type="text" class="form-input" [class.error]="errors.hangXeKhac"
                                    [(ngModel)]="step1Data.hangXeKhac" name="hangXeKhac" placeholder="">
                                <div *ngIf="errors.hangXeKhac" class="error-message">Vui lòng nhập tên hãng xe</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Mẫu xe</label>
                            <input type="text" class="form-input" [class.error]="errors.mauXe"
                                [(ngModel)]="step1Data.mauXe" name="mauXe" placeholder="">
                            <div *ngIf="errors.mauXe" class="error-message">Vui lòng nhập mẫu xe</div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Loại nhiên liệu</label>
                            <select class="form-input" [class.error]="errors.loaiNhienLieu"
                                [(ngModel)]="step1Data.loaiNhienLieu" name="loaiNhienLieu">
                                <option value="">-- Chọn loại nhiên liệu --</option>
                                <option value="Xăng">Xăng</option>
                                <option value="Dầu">Dầu</option>
                                <option value="Điện">Điện</option>
                                <option value="Hybrid">Hybrid</option>
                            </select>
                            <div *ngIf="errors.loaiNhienLieu" class="error-message">Vui lòng chọn loại nhiên liệu</div>
                        </div>
                        <div class="form-group">
                            <label>Số ghế</label>
                            <select class="form-input" [class.error]="errors.soGhe" [(ngModel)]="step1Data.soGhe"
                                name="soGhe">
                                <option value="">-- Chọn số ghế --</option>
                                <option value="4">4 ghế</option>
                                <option value="5">5 ghế</option>
                                <option value="7">7 ghế</option>
                                <option value="9">9 ghế</option>
                            </select>
                            <div *ngIf="errors.soGhe" class="error-message">Vui lòng chọn số ghế</div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Năm sản xuất</label>
                            <input type="number" class="form-input" [class.error]="errors.namSanXuat"
                                [(ngModel)]="step1Data.namSanXuat" name="namSanXuat" placeholder="" min="1900"
                                max="2026" maxlength="4" (input)="onYearChange()">
                            <div *ngIf="errors.namSanXuat" class="error-message">Vui lòng nhập năm sản xuất hợp lệ (4
                                chữ số từ 1900-2026)</div>
                        </div>
                        <div class="form-group">
                            <label>Truyền động</label>
                            <select class="form-input" [class.error]="errors.truyenDong"
                                [(ngModel)]="step1Data.truyenDong" name="truyenDong">
                                <option value="">-- Chọn truyền động --</option>
                                <option value="Số tự động">Số tự động</option>
                                <option value="Số sàn">Số sàn</option>
                            </select>
                            <div *ngIf="errors.truyenDong" class="error-message">Vui lòng chọn truyền động</div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Loại xe</label>
                            <select class="form-input" [class.error]="errors.loaiXe" [(ngModel)]="step1Data.loaiXe"
                                name="loaiXe" (change)="onCarTypeChange()">
                                <option value="">-- Chọn loại xe --</option>
                                <option value="Sedan">Sedan</option>
                                <option value="SUV">SUV</option>
                                <option value="Hatchback">Hatchback</option>
                                <option value="MPV">MPV</option>
                                <option value="Pickup">Pickup</option>
                                <option value="Coupe">Coupe</option>
                                <option value="Convertible">Convertible</option>
                                <option value="Crossover">Crossover</option>
                                <option value="Khác">Khác</option>
                            </select>
                            <div *ngIf="errors.loaiXe" class="error-message">Vui lòng chọn loại xe</div>

                            <!-- Input cho loại xe khác -->
                            <div *ngIf="step1Data.loaiXe === 'Khác'" class="mt-2">
                                <input type="text" class="form-input" [class.error]="errors.loaiXeKhac"
                                    [(ngModel)]="step1Data.loaiXeKhac" name="loaiXeKhac" placeholder="">
                                <div *ngIf="errors.loaiXeKhac" class="error-message">Vui lòng nhập loại xe</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Màu sắc</label>
                            <select class="form-input" [class.error]="errors.mauSac" [(ngModel)]="step1Data.mauSac"
                                name="mauSac" (change)="onCarColorChange()">
                                <option value="">-- Chọn màu sắc --</option>
                                <option value="Trắng">Trắng</option>
                                <option value="Đen">Đen</option>
                                <option value="Xám">Xám</option>
                                <option value="Đỏ">Đỏ</option>
                                <option value="Xanh">Xanh</option>
                                <option value="Bạc">Bạc</option>
                                <option value="Nâu">Nâu</option>
                                <option value="Vàng">Vàng</option>
                                <option value="Khác">Khác</option>
                            </select>
                            <div *ngIf="errors.mauSac" class="error-message">Vui lòng chọn màu sắc</div>

                            <!-- Input cho màu sắc khác -->
                            <div *ngIf="step1Data.mauSac === 'Khác'" class="mt-2">
                                <input type="text" class="form-input" [class.error]="errors.mauSacKhac"
                                    [(ngModel)]="step1Data.mauSacKhac" name="mauSacKhac" placeholder="">
                                <div *ngIf="errors.mauSacKhac" class="error-message">Vui lòng nhập màu sắc</div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label>Số nhiên liệu cho 100km</label>
                        <input type="text" class="form-input" [class.error]="errors.nhieuLieu100km"
                            [(ngModel)]="step1Data.nhieuLieu100km" name="nhieuLieu100km" placeholder="">
                        <div *ngIf="errors.nhieuLieu100km" class="error-message">Vui lòng nhập số lít nhiên liệu</div>
                    </div>
                </div>

                <!-- Mô tả -->
                <div class="form-section">
                    <h3>Mô tả</h3>
                    <textarea class="form-textarea full-width" [(ngModel)]="step1Data.moTa" name="moTa" placeholder=""
                        rows="8"></textarea>
                </div>
            </div>

            <!-- Step 2: Thông tin thuê xe -->
            <div *ngIf="currentStep === 2">
                <!-- Giá cho thuê -->
                <div class="form-section">
                    <h3>Giá cho thuê đề xuất</h3>
                    <p class="note">Đơn giá áp dụng cho tất cả các ngày. Bạn có thể tùy chỉnh giá khác cho các ngày đặc
                        biệt (cuối tuần, lễ, tết...) trong mục quản lý xe sau khi đăng kí.</p>

                    <div class="price-input-container">
                        <input type="text" class="form-input price-input" [class.error]="errors.giaChoThue"
                            [(ngModel)]="step2Data.giaChoThue" name="giaChoThue" placeholder=""
                            (input)="onPriceInput($event)">
                        <span class="price-unit">VNĐ/ngày</span>
                    </div>
                    <div class="price-suggestions">
                        <p class="suggestion-label">Gợi ý giá theo loại xe:</p>
                        <div class="suggestion-list">
                            <span class="suggestion-item" (click)="setSuggestedPrice(400000)">Sedan: 400.000đ</span>
                            <span class="suggestion-item" (click)="setSuggestedPrice(600000)">SUV: 600.000đ</span>
                            <span class="suggestion-item" (click)="setSuggestedPrice(800000)">Luxury: 800.000đ</span>
                        </div>
                    </div>
                    <div *ngIf="errors.giaChoThue" class="error-message">Vui lòng nhập giá cho thuê</div>
                </div>

                <!-- Địa điểm nhận xe -->
                <div class="form-section">
                    <h3>Địa điểm nhận xe</h3>
                    <p class="note">Lưu ý: Đây là địa điểm mà khách nhận xe.</p>

                    <div class="form-group">
                        <label>Thành phố, tỉnh:</label>
                        <select class="form-input" [class.error]="errors.thanhPho" [(ngModel)]="step2Data.thanhPho"
                            name="thanhPho" (change)="onProvinceChange()">
                            <option value="">-- Chọn tỉnh thành --</option>
                            <option *ngFor="let province of provinces" [value]="province">
                                {{ province }}
                            </option>
                        </select>
                        <div *ngIf="errors.thanhPho" class="error-message">Vui lòng chọn tỉnh thành</div>
                    </div>

                    <div class="form-group">
                        <label>Quận Huyện:</label>
                        <select class="form-input" [class.error]="errors.quanHuyen" [(ngModel)]="step2Data.quanHuyen"
                            name="quanHuyen" [disabled]="!step2Data.thanhPho">
                            <option value="">-- Chọn quận huyện --</option>
                            <option *ngFor="let district of currentDistricts" [value]="district">
                                {{ district }}
                            </option>
                        </select>
                        <div *ngIf="errors.quanHuyen" class="error-message">Vui lòng chọn quận huyện</div>
                    </div>

                    <div class="form-group">
                        <label>Địa chỉ cụ thể:</label>
                        <input type="text" class="form-input" [class.error]="errors.tenDuong"
                            [(ngModel)]="step2Data.tenDuong" name="tenDuong" placeholder="">
                        <div *ngIf="errors.tenDuong" class="error-message">Vui lòng nhập địa chỉ cụ thể</div>
                    </div>
                </div>

                <!-- Số km của xe -->
                <div class="form-section">
                    <h3>Số km của xe</h3>
                    <input type="text" class="form-input" [class.error]="errors.soKm" [(ngModel)]="step2Data.soKm"
                        name="soKm" placeholder="">
                    <div *ngIf="errors.soKm" class="error-message">Vui lòng nhập số km</div>
                </div>
            </div>

            <!-- Step 3: Hình ảnh xe -->
            <div *ngIf="currentStep === 3">
                <div class="form-section">
                    <!-- Ảnh biển số xe -->
                    <div class="upload-section">
                        <label class="upload-label">Ảnh chụp biển số xe rõ nét</label>
                        <div class="upload-area license-plate-upload" (click)="triggerFileInput('licensePlate')"
                            [class.has-image]="licensePlateImage">
                            <input #licensePlateInput type="file" accept="image/*"
                                (change)="onImageSelected($event, 'licensePlate')" hidden>
                            <div *ngIf="!licensePlateImage" class="upload-placeholder">
                                <i class="bi bi-camera"></i>
                                <p>Chụp ảnh biển số xe rõ nét</p>
                            </div>
                            <img *ngIf="licensePlateImage" [src]="licensePlateImage" class="preview-image"
                                alt="License Plate">
                        </div>
                    </div>

                    <!-- Giấy tờ xe và căn cước -->
                    <div class="upload-section">
                        <label class="upload-label">Giấy tờ xe và căn cước chủ xe</label>
                        <div class="documents-grid">
                            <!-- Giấy tờ xe -->
                            <div class="document-item">
                                <label class="document-label">Giấy tờ xe</label>
                                <div class="upload-area document-upload" (click)="triggerFileInput('vehicleDocuments')"
                                    [class.has-image]="vehicleDocumentsImage">
                                    <input #vehicleDocumentsInput type="file" accept="image/*,application/pdf"
                                        (change)="onImageSelected($event, 'vehicleDocuments')" hidden>
                                    <div *ngIf="!vehicleDocumentsImage" class="upload-placeholder">
                                        <i class="bi bi-file-earmark-text"></i>
                                        <p>Tải lên giấy tờ xe</p>
                                    </div>
                                    <img *ngIf="vehicleDocumentsImage" [src]="vehicleDocumentsImage"
                                        class="preview-image" alt="Vehicle Documents">
                                </div>
                            </div>

                            <!-- Căn cước chủ xe -->
                            <div class="document-item">
                                <label class="document-label">Căn cước chủ xe</label>
                                <div class="upload-area document-upload" (click)="triggerFileInput('ownerID')"
                                    [class.has-image]="ownerIDImage">
                                    <input #ownerIDInput type="file" accept="image/*,application/pdf"
                                        (change)="onImageSelected($event, 'ownerID')" hidden>
                                    <div *ngIf="!ownerIDImage" class="upload-placeholder">
                                        <i class="bi bi-person-badge"></i>
                                        <p>Tải lên căn cước</p>
                                    </div>
                                    <img *ngIf="ownerIDImage" [src]="ownerIDImage" class="preview-image" alt="Owner ID">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Grid ảnh xe để hiển thị trên web -->
                    <div class="upload-section">
                        <label class="upload-label">Hình ảnh xe (hiển thị trên website)</label>
                        <div class="upload-grid">
                            <!-- Ảnh xe 1 -->
                            <div class="upload-area grid-upload" (click)="triggerFileInput('car1')"
                                [class.has-image]="carImages[0]">
                                <input #car1Input type="file" accept="image/*"
                                    (change)="onImageSelected($event, 'car1')" hidden>
                                <div *ngIf="!carImages[0]" class="upload-placeholder">
                                    <i class="bi bi-camera"></i>
                                    <p>Hình ảnh xe 1</p>
                                </div>
                                <img *ngIf="carImages[0]" [src]="carImages[0]" class="preview-image" alt="Car 1">
                            </div>

                            <!-- Ảnh xe 2 -->
                            <div class="upload-area grid-upload" (click)="triggerFileInput('car2')"
                                [class.has-image]="carImages[1]">
                                <input #car2Input type="file" accept="image/*"
                                    (change)="onImageSelected($event, 'car2')" hidden>
                                <div *ngIf="!carImages[1]" class="upload-placeholder">
                                    <i class="bi bi-camera"></i>
                                    <p>Hình ảnh xe 2</p>
                                </div>
                                <img *ngIf="carImages[1]" [src]="carImages[1]" class="preview-image" alt="Car 2">
                            </div>

                            <!-- Ảnh xe 3 -->
                            <div class="upload-area grid-upload" (click)="triggerFileInput('car3')"
                                [class.has-image]="carImages[2]">
                                <input #car3Input type="file" accept="image/*"
                                    (change)="onImageSelected($event, 'car3')" hidden>
                                <div *ngIf="!carImages[2]" class="upload-placeholder">
                                    <i class="bi bi-camera"></i>
                                    <p>Hình ảnh xe 3</p>
                                </div>
                                <img *ngIf="carImages[2]" [src]="carImages[2]" class="preview-image" alt="Car 3">
                            </div>

                            <!-- Ảnh xe 4 -->
                            <div class="upload-area grid-upload" (click)="triggerFileInput('car4')"
                                [class.has-image]="carImages[3]">
                                <input #car4Input type="file" accept="image/*"
                                    (change)="onImageSelected($event, 'car4')" hidden>
                                <div *ngIf="!carImages[3]" class="upload-placeholder">
                                    <i class="bi bi-camera"></i>
                                    <p>Hình ảnh xe 4</p>
                                </div>
                                <img *ngIf="carImages[3]" [src]="carImages[3]" class="preview-image" alt="Car 4">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <button type="button" class="btn-secondary" (click)="previousStep()" [disabled]="currentStep === 1">
                    Quay lại
                </button>
                <button type="button" class="btn-primary" (click)="nextStep()" *ngIf="currentStep < 3">
                    Chuyển tiếp
                </button>
                <button type="submit" class="btn-primary" *ngIf="currentStep === 3">
                    Hoàn thành
                </button>
            </div>
        </form>
    </div>
</div>