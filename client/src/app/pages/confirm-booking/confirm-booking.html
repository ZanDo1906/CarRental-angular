<div class="booking-confirmation-container">
    <div class="booking-card">

        <!-- TRANG 1: Th√¥ng tin li√™n h·ªá & thanh to√°n -->
        <div *ngIf="currentPage === 1">
            <!-- Th√¥ng tin li√™n h·ªá -->
            <section class="contact-section">
                <h2 class="section-title">TH√îNG TIN LI√äN H·ªÜ</h2>

                <div class="info-group">
                    <label class="info-label">H·ªç v√† t√™n: <span class="required">*</span></label>
                    <div class="info-display">{{ currentUser?.Ho_va_ten || 'Ch∆∞a ƒëƒÉng nh·∫≠p' }}</div>
                </div>

                <div class="info-group">
                    <label class="info-label">S·ªë ƒëi·ªán tho·∫°i: <span class="required">*</span></label>
                    <div class="info-display">{{ currentUser?.So_dien_thoai || 'Ch∆∞a ƒëƒÉng nh·∫≠p' }}</div>
                </div>

                <div class="info-group">
                    <label class="info-label">Email: <span class="required">*</span></label>
                    <div class="info-display">{{ currentUser?.Email || 'Ch∆∞a ƒëƒÉng nh·∫≠p' }}</div>
                </div>

                <div class="info-group">
                    <label class="info-label">ƒê·ªãa ch·ªâ: <span class="required">*</span></label>
                    <input 
                        type="text" 
                        class="info-input" 
                        [(ngModel)]="userAddress" 
                        (input)="onAddressInput()"
                        placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ c·ªßa b·∫°n"
                        required>
                </div>
            </section>

            <!-- Th√¥ng tin thanh to√°n -->
            <section class="payment-section">
                <h2 class="section-title">TH√îNG TIN THANH TO√ÅN</h2>

                <div class="payment-summary">
                    <div class="payment-row">
                        <span class="payment-label">T·ªïng ti·ªÅn:</span>
                        <span class="payment-amount">{{ formatCurrency(bookingData.payment.subtotal) }}</span>
                    </div>

                    <div class="payment-row">
                        <span class="payment-label">Gi·∫£m gi√°:</span>
                        <span class="payment-amount discount">{{ formatCurrency(bookingData.payment.discount) }}</span>
                    </div>

                    <div class="payment-row">
                        <span class="payment-label">Thu·∫ø VAT:</span>
                        <span class="payment-amount">{{ formatCurrency(bookingData.payment.vat) }}</span>
                    </div>

                    <div class="payment-divider"></div>

                    <div class="payment-row total-row">
                        <span class="payment-label total-label">TH√ÄNH TI·ªÄN:</span>
                        <span class="payment-amount total-amount">{{ formatCurrency(bookingData.payment.total) }}</span>
                    </div>
                </div>

                <!-- Th√¥ng b√°o ki·ªÉm tra -->
                <div class="validation-reminder">
                    <p class="reminder-text">Vui l√≤ng ki·ªÉm tra l·∫°i c√°c th√¥ng tin tr√™n tr∆∞·ªõc khi b·∫•m X√°c nh·∫≠n</p>
                </div>

                <!-- Th√¥ng b√°o l·ªói validation -->
                <div *ngIf="showAddressError" class="validation-error">
                    <p class="error-text">Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin ƒë·ªãa ch·ªâ</p>
                </div>

                <!-- N√∫t x√°c nh·∫≠n -->
                <div class="button-group">
                    <button class="back-button" (click)="goBackToPreviousPage()">
                        Quay l·∫°i
                    </button>
                    <button 
                        class="confirm-button" 
                        (click)="onConfirmBooking()">
                        X√°c nh·∫≠n ƒë·∫∑t xe
                    </button>
                </div>
            </section>
        </div>

        <!-- TRANG 2: Th√¥ng tin ƒë∆°n thu√™ -->
        <div *ngIf="currentPage === 2">
            <!-- Ti√™u ƒë·ªÅ -->
            <h1 class="section-title">TH√îNG TIN ƒê∆†N THU√ä</h1>

            <!-- H√¨nh ·∫£nh xe -->
            <div class="car-image-section">
                <div *ngIf="carImages && carImages.length > 0; else placeholderTemplate" class="car-image-container">
                    <img [src]="carImages[0]" [alt]="orderDetails.carInfo.name" class="car-image" 
                         (error)="$any($event).target.style.display='none'">
                </div>
                <ng-template #placeholderTemplate>
                    <div class="car-image-placeholder">
                        <div class="placeholder-icon">üöó</div>
                    </div>
                </ng-template>
            </div>

            <!-- Th√¥ng tin xe -->
            <div class="car-info-section">
                <div class="car-info-row">
                    <span class="car-info-label">T√™n xe:</span>
                    <span class="car-info-value">{{ orderDetails.carInfo.name }}</span>
                </div>

                <div class="car-info-row">
                    <span class="car-info-label">S·ªë ch·ªó:</span>
                    <span class="car-info-value">{{ orderDetails.carInfo.seats }}</span>
                </div>

                <div class="car-info-row">
                    <span class="car-info-label">Nhi√™n li·ªáu:</span>
                    <span class="car-info-value">{{ orderDetails.carInfo.fuel }}</span>
                </div>

                <div class="car-info-row">
                    <span class="car-info-label">H·ªôp s·ªë:</span>
                    <span class="car-info-value">{{ orderDetails.carInfo.transmission }}</span>
                </div>

                <div class="car-info-row">
                    <span class="car-info-label">Ti√™u th·ª•:</span>
                    <span class="car-info-value">{{ orderDetails.carInfo.fuelConsumption }}</span>
                </div>
            </div>

            <!-- Th√¥ng tin th·ªùi gian -->
            <div class="time-section">
                <div class="time-inputs">
                    <div class="time-group">
                        <label class="time-label">Th·ªùi gian nh·∫≠n</label>
                        <input type="text" class="time-input" [value]="formatDateTime(orderDetails.timeInfo.startTime)"
                            placeholder="VD: 14:00, 15/11/2025" readonly disabled>
                    </div>

                    <div class="time-group">
                        <label class="time-label">Th·ªùi gian tr·∫£</label>
                        <input type="text" class="time-input" [value]="formatDateTime(orderDetails.timeInfo.endTime)"
                            placeholder="VD: 14:00, 17/11/2025" readonly disabled>
                    </div>
                </div>

                <div class="location-group">
                    <label class="location-label">ƒê·ªãa ƒëi·ªÉm nh·∫≠n xe</label>
                    <div class="location-display">{{ orderDetails.timeInfo.pickupLocation || 'Ch∆∞a c√≥ th√¥ng tin' }}</div>
                </div>
            </div>

            <!-- Th√¥ng b√°o ki·ªÉm tra -->
            <div class="validation-reminder">
                <p class="reminder-text">Vui l√≤ng ki·ªÉm tra l·∫°i c√°c th√¥ng tin tr√™n tr∆∞·ªõc khi b·∫•m X√°c nh·∫≠n</p>
            </div>

            <!-- N√∫t h√†nh ƒë·ªông -->
            <div class="button-group">
                <button class="back-button" (click)="goToPreviousPage()">
                    Quay l·∫°i
                </button>
                <button class="confirm-button" (click)="onConfirmPayment()">
                    X√°c nh·∫≠n thanh to√°n
                </button>
            </div>
        </div>

        <!-- TRANG 3: QR Code thanh to√°n -->
        <div *ngIf="currentPage === 3">
            <!-- Th√¥ng tin thanh to√°n -->
            <div class="payment-info-section">
                <h2 class="payment-title">Vui l√≤ng thanh to√°n ph√≠ gi·ªØ ch·ªó</h2>
                <div class="payment-amount-display">{{ formatCurrency(displayAmount) }}</div>
                <p class="payment-note">Th·ªùi gian gi·ªØ ch·ªó c√≤n l·∫°i</p>

                <div class="countdown-section">
                    <input type="text" class="countdown-input" [value]="countdown + 's'" readonly>
                </div>

                <p class="order-code">M√£ ƒë∆°n thu√™ c·ªßa b·∫°n: {{ orderCode }}</p>
            </div>

            <!-- QR Code Section -->
            <div class="qr-section">
                <h3 class="qr-title">Thanh to√°n b·∫±ng QR code</h3>
                <p class="qr-subtitle">Qu√©t QR ƒë·ªÉ chuy·ªÉn kho·∫£n</p>

                <div class="qr-code-container">
                    <img [src]="generateQRUrl()" alt="QR Code thanh to√°n" class="qr-code-image"
                        (error)="$any($event).target.style.display='none'">
                </div>

                <!-- Th√¥ng tin ng√¢n h√†ng chi ti·∫øt -->
                <div class="bank-info-section">
                    <h4 class="bank-info-title">üè¶ Th√¥ng tin ng√¢n h√†ng:</h4>

                    <div class="bank-details">
                        <div class="bank-row">
                            <span class="bank-label">Ng√¢n h√†ng:</span>
                            <span class="bank-value">VCB (Vietcombank)</span>
                        </div>

                        <div class="bank-row">
                            <span class="bank-label">S·ªë t√†i kho·∫£n:</span>
                            <span class="bank-value highlight">{{ qrPayment.account }}</span>
                        </div>

                        <div class="bank-row">
                            <span class="bank-label">T√™n t√†i kho·∫£n:</span>
                            <span class="bank-value">{{ qrPayment.accountName }}</span>
                        </div>

                        <div class="bank-row">
                            <span class="bank-label">N·ªôi dung:</span>
                            <span class="bank-value message">{{ qrPayment.message }}</span>
                        </div>
                    </div>
                </div>

                <div class="contact-support">
                    <p>Li√™n h·ªá b·ªô ph·∫≠n <a href="tel:0123456789" class="cskh-link"><strong>CSKH</strong></a> n·∫øu c√≥ b·∫•t k·ª≥ th·∫Øc m·∫Øc n√†o!</p>
                </div>

                <!-- N√∫t quay l·∫°i cho trang 3 -->
                <div class="button-group">
                    <button class="back-button" (click)="goToPreviousPage()">
                        Quay l·∫°i
                    </button>
                </div>
            </div>
        </div>

        <!-- TRANG 4: ƒê·∫∑t ƒë∆°n thu√™ th√†nh c√¥ng -->
        <div *ngIf="currentPage === 4">
            <div class="success-section">
                <h1 class="success-title">ƒê·∫∂T ƒê∆†N THU√ä TH√ÄNH C√îNG</h1>

                <div class="success-content">
                    <h2 class="success-subtitle">ƒê·∫∑t ƒë∆°n thu√™ xe th√†nh c√¥ng!</h2>
                    <p class="success-message">Vui l√≤ng theo d√µi t√¨nh tr·∫°ng ƒë∆°n thu√™</p>
                </div>

                <div class="success-actions">
                    <button class="action-btn detail-btn" (click)="goToUserRental()">Xem chi ti·∫øt</button>
                    <button class="action-btn back-btn" (click)="goBackToHome()">Quay l·∫°i</button>
                </div>
            </div>
        </div>

    </div>
</div>